const ports = [];

function tabUpdate(win) {
  chrome.tabs.query({ windowId: win }, function (tabs) {
    let html = "";
    for (var i in tabs) {
      let tab = tabs[i];
      let favicon = tab.favIconUrl;
      if (!favicon || favicon.startsWith("chrome://")) {
        favicon =
          "data:image/png;base64,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";
      }
      html += `<img data-id="${tab.id}" title="${tab.title}" src="${favicon}" />`;
    }

    for (var i in ports) {
      if (ports[i].sender.tab.windowId === win) {
        try {
          ports[i].postMessage({ tabId: ports[i].sender.tab.id, tabs: html });
        } catch (e) {
          console.log("Error: " + e);
        }
      }
    }
  });
}

chrome.tabs.onUpdated.addListener((tabId, changeInfo, tab) => {
  tabUpdate(tab.windowId);
});

chrome.tabs.onCreated.addListener((tab) => {
  tabUpdate(tab.windowId);
});

chrome.tabs.onRemoved.addListener((tabId, removeInfo) => {
  tabUpdate(removeInfo.windowId);
});

chrome.runtime.onConnect.addListener((port) => {
  ports.push(port);
  port.onMessage.addListener(function (msg) {
    if (msg.action == "activate") {
      chrome.tabs.update(msg.tab, { active: true });
    } else if (msg.action == "close") {
      chrome.tabs.remove(msg.tab);
    }
  });
  port.onDisconnect.addListener(function () {
    ports.splice(ports.indexOf(port), 1);
  });
});
